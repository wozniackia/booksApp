<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap" rel="stylesheet">
    <style>
      body {
  background-color: #2ab7ca;
  font-family: "Ubuntu", sans-serif;
  margin: 0;
}

nav {
  box-shadow: 0px 0px 10px 0px rgba(66, 68, 90, 1);
}

a {
  text-decoration: none;
}

.center {
  margin: 0;
  position: absolute;
  left: 50%;
  transform: translate(-50%, -50%);
}

.middle {
  margin: 0;
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
}

.top {
  margin: 0;
  position: absolute;
  top: 25%;
}

.bottom {
  margin: 0;
  position: absolute;
  top: 95%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.under_center {
  margin: 0;
  position: absolute;
  top: 65%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.under_center div {
  margin: 0px;
  padding-top: 10px;
  padding-bottom: 0px;
}

.white_text {
  color: #ffffff;
}

.center_text {
  padding: 70px 0;
  text-align: center;
}

.big_text {
  font-size: 50px;
}

.medium_text {
  font-size: 25px;
}

.small_text {
  font-size: 15px;
}
form {
  top: 100px;
}
    </style>
    <link rel="stylesheet" href="../styles/add-book.css">
    <title>BooksApp</title>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="http://localhost:3000/">
          <img src="http://localhost:3000/logo" alt="" width="50" height="50">
          BooksApp
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="http://localhost:3000/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://localhost:3000/browse">Browse books</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="http://localhost:3000/add">Add books</a>
          </li>
        </ul>
        <form class="d-flex">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>

  <div class="position-absolute top-50 start-50 translate-middle">
    <form class="d-flex needs-validation" id="formularz">
      <input class="form-control me-2" type="search" id="bookName" placeholder="Book name" aria-label="Search">
      <div class="invalid-feedback">
        Please provide a valid name.
      </div>
      <button class="btn btn-light" type="submit">Add</button>
    </form>
  
    <ul class="list-group" id="lista">
      <li class="list-group-item">Book name: <div id="listName"></div></li>
      <li class="list-group-item">Author: <div id="listAuthor"></div></li>
      <li class="list-group-item">Release date: <div id="listDate"></div></li>
      <button type="button" class="btn btn-light" id="buttonRequest">Accept</button>
    </ul>
  </div>
  
  <div class="modal" id="bookAddedModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Book added</h5>
          <button id="closeModal"type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Book added succesfully!</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://kit.fontawesome.com/28100bcb2a.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script>
    function handleFormSubmit(event) {
  event.preventDefault();
  
  const data = new FormData(event.target);
  
  const formJSON = Object.fromEntries(data.entries());
  
  // let uri = 'https://wozniacki-booksapp.herokuapp.com/books/addBook?name='+formJSON.name;
  let uri = 'https://openlibrary.org/search.json?q='+formJSON.name;
    axios.post(uri)
    .then(function (response) {
    });
}

document.querySelector('form').addEventListener('submit', handleFormSubmit);
function hideModal () {
  modal.style.display = "none";
}

function handleFormSubmit(event) {
  document.getElementById('listName').classList.add("placeholder");
  document.getElementById('listAuthor').classList.add("placeholder");
  document.getElementById('listDate').classList.add("placeholder");
  document.getElementById('buttonRequest').classList.add("placeholder");
  event.preventDefault();
  let uri = 'https://openlibrary.org/search.json?q='+bookName.value;
  axios.get(uri)
    .then(function (response) {
      sendRequest = () => {
        let uri2 = 'https://wozniacki-booksapp.herokuapp.com/books/addBook?name='+response.data.docs[0]["title"]
        axios.post(uri2)
          .then(function (response) {
            console.log('yupi')
            modal.style.display = "block";
          })
      }
      document.getElementById('listName').classList.remove("placeholder");
      document.getElementById('listAuthor').classList.remove("placeholder");
      document.getElementById('listDate').classList.remove("placeholder");
      document.getElementById('buttonRequest').classList.remove("placeholder");
      document.getElementById('listName').innerHTML = response.data.docs[0]["title"]
      document.getElementById('listAuthor').innerHTML = response.data.docs[0]["author_name"][0]
      document.getElementById('listDate').innerHTML = response.data.docs[0]["first_publish_year"]
      document.getElementById('buttonRequest').onclick = sendRequest
      lista.classList.remove("visually-hidden");
    });
}

const lista = document.getElementById('lista')
const bookName = document.getElementById('bookName')
const formularz = document.getElementById('formularz')
const modal = document.getElementById('bookAddedModal')
const closeModal = document.getElementById('closeModal').onclick = hideModal
formularz.addEventListener('submit', handleFormSubmit);

  </script>
</body>
</html>